(function(){var a,b,c,d,e,f,g,h,i,j,k;j=0,i=1,h=function(a){return a?i:j},e=function(a,b){var c;return c=new Object,a.filter(function(a){var d;return d=b(a),c.hasOwnProperty(d)?!1:c[d]=!0})},g=function(a,b){var c;return c=b+a,3===c?i:4===c?a:j},d=function(a,b){var c,d,e,f;for(f=[],c=d=0,e=a.length;e>=0?e>d:d>e;c=e>=0?++d:--d)f.push(a[c].concat(b[c]));return f},f=function(a){var b,c,d,e,f;for(b=[],c=[],d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)b.push(a[d].slice(0,a.length)),c.push(a[d].slice(a.length,2*a.length));return[b,c]},b=function(){function a(b,c,d,e,f,g){this.nw=null!=b?b:j,this.ne=null!=c?c:j,this.sw=null!=d?d:j,this.se=null!=e?e:j,this.id=null!=f?f:0,this.library=null!=g?g:a._default_library,null!=this.nw._level?(this._level=this.nw._level+1,this._population=this.nw._population+this.ne._population+this.sw._population+this.se._population,this.n=this.library.get(this.nw.ne,this.ne.nw,this.nw.se,this.ne.sw),this.s=this.library.get(this.sw.ne,this.se.nw,this.sw.se,this.se.sw),this.w=this.library.get(this.nw.sw,this.nw.se,this.sw.nw,this.sw.ne),this.e=this.library.get(this.ne.sw,this.ne.se,this.se.nw,this.se.ne),this.c=this.library.get(this.nw.se,this.ne.sw,this.sw.ne,this.se.nw)):(this._level=1,this._population=this.nw+this.ne+this.sw+this.se,"number"!=typeof this.nw&&(this.nw=h(this.nw),this.ne=h(this.ne),this.sw=h(this.sw),this.se=h(this.se))),this._result=null}return a.from_array=function(b){var c,d,e,f,g,h;for(h=Math.sqrt(b.length),g=[],c=d=0,e=b.length,f=h;f>0?e>d:d>e;c=d+=f)g.push(b.slice(c,c+h));return a._from_row_array(g)},a._from_row_array=function(b){var c,d,e,g,h,i,j;return 2===b.length?new a(b[0][0],b[0][1],b[1][0],b[1][1]):(c=b.length/2,g=f(b.slice(0,c)),e=g[0],d=g[1],h=f(b.slice(c,b.length)),j=h[0],i=h[1],new a(a._from_row_array(e),a._from_row_array(d),a._from_row_array(j),a._from_row_array(i)))},a._default_library={get:function(b,c,d,e){return new a(b,c,d,e)}},a.prototype._to_row_array=function(){var a,b;return 1===this._level?[[this.nw,this.ne],[this.sw,this.se]]:(b=d(this.nw._to_row_array(),this.ne._to_row_array()),a=d(this.sw._to_row_array(),this.se._to_row_array()),b.concat(a))},a.prototype.to_array=function(){return this._to_row_array().reduce(function(a,b){return a.concat(b)})},a.prototype._base_case=function(){return this.library.get(g(this.nw.se,this.nw.nw+this.nw.ne+this.nw.sw+this.ne.nw+this.ne.sw+this.sw.nw+this.sw.ne+this.se.nw),g(this.ne.sw,this.nw.ne+this.nw.se+this.ne.nw+this.ne.ne+this.ne.se+this.sw.ne+this.se.nw+this.se.ne),g(this.sw.ne,this.nw.sw+this.nw.se+this.ne.sw+this.sw.nw+this.sw.sw+this.sw.se+this.se.nw+this.se.sw),g(this.se.nw,this.nw.se+this.ne.sw+this.ne.se+this.sw.ne+this.sw.se+this.se.ne+this.se.sw+this.se.se))},a.prototype._recursive_case=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;return e=this.nw.future(),d=this.ne.future(),h=this.sw.future(),g=this.se.future(),c=this.n.future(),f=this.s.future(),i=this.w.future(),b=this.e.future(),a=this.c.future(),k=this.library.get(e,c,i,a).future(),j=this.library.get(c,d,a,b).future(),m=this.library.get(i,a,h,f).future(),l=this.library.get(a,b,f,g).future(),this.library.get(k,j,m,l)},a.prototype.future=function(){return null!=this._result?this._result:0===this._population?this._result=this.nw:2===this._level?this._result=this._base_case():this._level>2?this._result=this._recursive_case():void 0},a.prototype.level=function(){return this._level},a.prototype.size=function(){return Math.pow(2,this._level)},a.prototype.step_size=function(){return Math.pow(2,this._level-2)},a.prototype.population=function(){return this._population},a}(),a=function(){function a(){this._id=0,this._map=new Object}return a._hash=function(a,b,c,d){return null!=a._level&&a._level>=1?a.id+"-"+b.id+"-"+c.id+"-"+d.id:(a<<3|b<<2|c<<1|d).toString()},a.prototype.size=function(){return this._id},a.prototype.get=function(c,d,e,f){var g,h;return g=a._hash(c,d,e,f),h=this._map[g],void 0===h?(this._map[g]=new b(c,d,e,f,this._id,this),++this._id,this._map[g]):h},a}(),c=function(){function b(a){this._size=Math.pow(2,a),this._init_library(a)}return b.prototype._init_library=function(b){var c,d;for(this._library=new a,this._root=this._library.get(j,j,j,j),c=1,d=[];b>c;)this._root=this._library.get(this._root,this._root,this._root,this._root),d.push(++c);return d},b.prototype.size=function(){return this._size},b.prototype._get_child=function(a,b,c){var d,e;return e="",d=.25*a.size(),0>b?(b+=d,0>c?(e="sw",c+=d):(e="nw",c-=d)):(b-=d,0>c?(e="se",c+=d):(e="ne",c-=d)),{key:e,x:b,y:c}},b.prototype._trace_to_base=function(a,b){var c,d,e;for(e=[],c=this._root;null!=c.level;)d=this._get_child(c,a,b),d.parent=c,e.push(d),c=c[d.key],a=d.x,b=d.y;return e},b.prototype.set=function(a,b){var c,d,e,f,g,h;if(c=.5*this._size,!(-c>a||a>=c||-c>b||b>=c)){for(g=i,h=this._trace_to_base(a,b),d=h.length-1;d>=0;)f=h[d],e={nw:f.parent.nw,ne:f.parent.ne,sw:f.parent.sw,se:f.parent.se},e[f.key]=g,g=this._library.get(e.nw,e.ne,e.sw,e.se),--d;return this._root=g}},b.prototype._get=function(a,b,c,d){var f,g,h,j,k,l,m,n,o,p,q;return null==b&&(b=this._root),null==c&&(c=0),null==d&&(d=0),j=[],0===b.population()?j:1===b._level?(b.nw===i&&j.push({x:-1+c,y:d}),b.ne===i&&j.push({x:c,y:d}),b.sw===i&&j.push({x:-1+c,y:-1+d}),b.se===i&&j.push({x:c,y:-1+d}),j):(h=b.step_size(),a>=h?this._get(a-h,b.future(),c,d):(a>0&&(k=this._get(a,b.n,c,d+h),n=this._get(a,b.s,c,d-h),g=this._get(a,b.e,c+h,d),q=this._get(a,b.w,c-h,d),f=this._get(a,b.c,c,d),j=j.concat(k,n,g,q,f)),m=this._get(a,b.nw,c-h,d+h),l=this._get(a,b.ne,c+h,d+h),p=this._get(a,b.sw,c-h,d-h),o=this._get(a,b.se,c+h,d-h),j=j.concat(m,l,p,o),b===this._root&&(j=e(j,function(a){return a.x+","+a.y})),j))},b.prototype.get=function(a){return this._get(a>=0?Math.pow(2,a):0)},b}(),k=this,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)&&(module.exports.MacroCell=b,module.exports.Library=a,module.exports.Simulation=c,module.exports.dead=j,module.exports.alive=i),k.gol={MacroCell:b,Library:a,Simulation:c,dead:j,alive:i}}).call(this);